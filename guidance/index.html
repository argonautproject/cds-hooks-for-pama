



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.2">
    
    
      
        <title>Guidance - CDS Hooks For PAMA</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#cds-client-prepares-a-pama-request" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="CDS Hooks For PAMA" aria-label="CDS Hooks For PAMA" class="md-header-nav__button md-logo">
          
            <img alt="logo" src="../images/logo-square.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              CDS Hooks For PAMA
            </span>
            <span class="md-header-nav__topic">
              
                Guidance
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/argonautproject/cds-hooks-for-pama/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="CDS Hooks For PAMA" class="md-nav__button md-logo">
      
        <img alt="logo" src="../images/logo-square.png" width="48" height="48">
      
    </a>
    CDS Hooks For PAMA
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/argonautproject/cds-hooks-for-pama/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Guidance
      </label>
    
    <a href="./" title="Guidance" class="md-nav__link md-nav__link--active">
      Guidance
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cds-client-prepares-a-pama-request" class="md-nav__link">
    CDS Client Prepares a PAMA Request
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#servicerequest-profile" class="md-nav__link">
    ServiceRequest Profile
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cds-service-returns-a-pama-response" class="md-nav__link">
    CDS Service returns a PAMA Response
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cds-client-processes-pama-response" class="md-nav__link">
    CDS Client Processes PAMA Response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cds-companion-app-updates-orders" class="md-nav__link">
    CDS Companion App Updates Orders
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#end-to-end-example-cds-scenario" class="md-nav__link">
    End to end example CDS Scenario
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cds-client" class="md-nav__link">
    CDS Client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cds-service-responses" class="md-nav__link">
    CDS Service Responses
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references-and-links" class="md-nav__link">
    References and Links
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps-to-add-once-web-messaging-spec-is-ready" class="md-nav__link">
    Steps to add once Web Messaging spec is ready
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cds-client-prepares-a-pama-request" class="md-nav__link">
    CDS Client Prepares a PAMA Request
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#servicerequest-profile" class="md-nav__link">
    ServiceRequest Profile
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cds-service-returns-a-pama-response" class="md-nav__link">
    CDS Service returns a PAMA Response
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cds-client-processes-pama-response" class="md-nav__link">
    CDS Client Processes PAMA Response
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cds-companion-app-updates-orders" class="md-nav__link">
    CDS Companion App Updates Orders
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#end-to-end-example-cds-scenario" class="md-nav__link">
    End to end example CDS Scenario
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cds-client" class="md-nav__link">
    CDS Client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cds-service-responses" class="md-nav__link">
    CDS Service Responses
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references-and-links" class="md-nav__link">
    References and Links
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps-to-add-once-web-messaging-spec-is-ready" class="md-nav__link">
    Steps to add once Web Messaging spec is ready
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/argonautproject/cds-hooks-for-pama/edit/master/docs/guidance.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Guidance</h1>
                
                <p><strong>Background</strong></p>
<p>To incentivize appropriate use of advanced medical diagnostic imaging services (e.g. computed tomography (CT) positron emission tomography (PET), etc.), Medicare put rules in place to require that providers consult with <a href="https://www.cms.gov/medicare/quality-initiatives-patient-assessment-instruments/appropriate-use-criteria-program/index.html">Appropriate Use Criteria</a> (AUC) when ordering certain imaging procedures. The initial Education and Operations Testing Period for this CMS program began January 1, 2020, with additional requirements starting in 2021. This implementation guide describes the use of <a href="https://cds-hooks.org/#overview">CDS Hooks</a> to evaluate appropriate use criteria. It is designed to help EHR developers and Qualified Clinical Decision Support Mechanism (qCDSM) developers to implement support for AUCs with a consistent, repeatable pattern.</p>
<p>More information can be found in the <a href="https://microsoft-healthcare-madison.github.io/demo-auc-app/#1"><strong>PAMA</strong> section of this codelab</a>.</p>
<p><strong>Overview</strong></p>
<p>While a clinician is still in the act of placing an order, the EHR invokes an <a href="https://cds-hooks.org/hooks/order-select/">order-select</a> or <a href="https://cds-hooks.org/hooks/order-sign/">order-sign</a> CDS Hook, passing the draft order(s) as FHIR <code>ServiceRequest</code> resources within the <code>"draftOrders"</code> context. The CDS Service can do one or more of the following:</p>
<ul>
<li>Respond with a top-level <code>extension.systemActions</code> (defined below) that attaches an appropriateness <code>Rating</code> directly to the draft order(s); this is typically a "best-effort" Rating that might be improved with the availability of additional information.</li>
<li>Respond with suggestion cards that convey valid alternatives to the draft order (where each alternative includes a pre-calculated appropriateness <code>Rating</code> based on available information)</li>
<li>Respond with an "App Link" card to gather additional information and generate more suitable orders or a more accurate <code>Rating</code></li>
</ul>
<p>This implementation guide proposes a small spanning set of appropriateness rating <code>Codings</code>, which can be further extended with translations from more specific values for each set of Appropriate Use Criteria.</p>
<h2 id="cds-client-prepares-a-pama-request">CDS Client Prepares a PAMA Request<a class="headerlink" href="#cds-client-prepares-a-pama-request" title="Permanent link">&para;</a></h2>
<p>A PAMA Request uses the <a href="https://cds-hooks.org/hooks/order-select/"><code>order-select</code></a> hook
 or the <a href="https://cds-hooks.org/hooks/order-sign/"><code>order-sign</code></a> hook. In general, CDS Clients should attempt to provide decision support as early in the workflow as is feasible, to prevent repeated data entry or surprising evaluations. This means that qCDSM implementers should prefer responding to instances of the <code>order-select</code> hook, since it fires several times <em>before</em> a clinician finalizes an order by <em>signing</em> it. The <code>order-sign</code> hook only fires after all the order details are complete and the clinician is ready to finalize the order by <em>signing</em> it. </p>
<p>The request context <strong>SHALL</strong> include:</p>
<ul>
<li>The <code>draftOrders</code> field with a FHIR R4 bundle of <a href="http://hl7.org/fhir/servicerequest.html"><code>ServiceRequest</code></a> resources (and any other unsigned orders from this session) following the <code>ServiceRequest</code> profile below.</li>
</ul>
<h3 id="servicerequest-profile"><code>ServiceRequest</code> Profile<a class="headerlink" href="#servicerequest-profile" title="Permanent link">&para;</a></h3>
<ul>
<li><code>status</code> - FHIR value set <a href="http://build.fhir.org/valueset-request-status.html"><code>RequestStatus</code></a></li>
<li><code>intent</code> - FHIR value set <a href="http://build.fhir.org/valueset-request-intent.html"><code>RequestIntent</code></a></li>
<li><code>code</code> - CPT (extensible). Recommend SNOMED/LOINC if CPT is unavailable. Systems should also include <code>Codings</code> with more detail (e.g. via proprietary or local codes as a last resort)</li>
<li><code>subject</code> - Patient</li>
<li><code>reasonCode</code> - ICD-10 or SNOMED CT (preferred)  </li>
</ul>
<h2 id="cds-service-returns-a-pama-response">CDS Service returns a PAMA Response<a class="headerlink" href="#cds-service-returns-a-pama-response" title="Permanent link">&para;</a></h2>
<p>Since a CDS Service might offer multi-purpose advice, accepting PAMA Requests as well as unrelated requests, the CDS Service must first determine whether each incoming draft <code>ServiceRequest</code> is "PAMA-relevant". At a minimum, the CDS Service SHALL recognize <code>ServiceRequests</code> that pertain to priority clinical areas defined by CMS, and MAY recognize additional clinical areas.</p>
<p>For each PAMA-relevant <code>ServiceRequest</code>, the CDS Service SHALL evaluate its PAMA AUCs and attempt to assign one of three PAMA <code>Rating</code> values (<code>appropriate</code> if there is an AUC consistent with the proposed imaging order, <code>not-appropriate</code> if there is an AUC that contra-indicates the proposed imaging order, or <code>no-criteria-apply</code> if no AUC pertains to the proposed imaging order). In the event that not enough information is available to reach one of these ratings (e.g., if key data have not been captured in a structured form), the CDS Service SHALL NOT produce a PAMA Response for the <code>ServiceRequest</code>, and SHOULD instead offer Cards with app links or suggestions that would lead to a computable rating (e.g., a link to an app that would collect additional information necessary to evaluate an AUC).</p>
<p>For each PAMA-relevant <code>ServiceRequest</code> where a rating has been determined, the CDS Service SHALL provide a PAMA Response by including the required PAMA extensions described below.</p>
<p>The CDS Service produces a PAMA Response for each PAMA-relevant <code>ServiceRequest</code> by:</p>
<ol>
<li>Creating an <code>systemActions</code> list as a root-level extension (see extension details below).</li>
<li>Optionally creating a set of proposed alternative orders, as <em>suggestion</em> cards.</li>
<li>Optionally creating a set of <em>app link</em> cards to launch external apps to capture additional data (e.g. prior diagnostic work completed, previous procedures performed, information from review of systems) or to provide advice. </li>
</ol>
<p>Argonaut CDS Hooks extension for PAMA, to be used at the top level of a CDS Hooks Response:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Optionality</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>systemActions</code></td>
<td>OPTIONAL</td>
<td><em>array</em></td>
<td>An array of <code>action</code> elements, following the same schema as the actions of a <em>suggestion card</em>. Each action must use <code>type: "update"</code> to update a single <code>ServiceRequest</code>; the update MUST NOT make any semantic change to the <code>ServiceRequest</code>, but may attach appropriateness rating extensions.</td>
</tr>
</tbody>
</table>
<p>Argonaut FHIR extensions for PAMA, within each <code>**ServiceRequest**</code> resource to communicate:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Optionality</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>http://fhir.org/argonaut/Extension/pama-rating</code></td>
<td>REQUIRED</td>
<td><code>*CodeableConcept*</code></td>
<td>MUST include a Coding with system <code>http://fhir.org/argonaut/CodeSystem/pama-rating</code> and code <code>appropriate</code> or <code>not-appropriate</code> or <code>no-criteria-apply</code>. If a CDS Service cannot assign one of these three codes to a given <code>ServiceRequest</code>, then it SHALL NOT include the undetermined <code>ServiceRequest</code> within the <code>systemActions</code> list. qCDSMs MAY include additional translation <code>Codings</code> with more specific, finer-grained scores. For example, an AUC score with a numeric value or alternative code such as <code>'May be appropriate'</code>. (To explicitly tie these three codes back to <a href="https://www.cms.gov/Regulations-and-Guidance/Guidance/Transmittals/2018Downloads/R2040OTN.pdf">language from CMS</a>: <code>appropriate</code> corresponds with what CMS describes as "adheres to appropriate use criteria"; <code>not-appropriate</code> corresponds with "does not adhere to appropriate use criteria"; and <code>no-criteria-apply</code> corresponds with "there is no appropriate use criteria applicable".)</td>
</tr>
<tr>
<td><code>http://fhir.org/argonaut/Extension/pama-rating-qcdsm-consulted</code></td>
<td>REQUIRED</td>
<td><code>*string*</code></td>
<td>CMS-assigned identifier for this Qualified CDS Mechanism consulted (also known as a "G-code").</td>
</tr>
<tr>
<td><code>http://fhir.org/argonaut/Extension/pama-rating-consult-id</code></td>
<td>REQUIRED</td>
<td><code>*uri*</code></td>
<td>Unique correlation handle that can be used for audit logging and, if needed, reporting to CMS as the Unique Consultation Identifier (UCI).</td>
</tr>
<tr>
<td><code>http://fhir.org/argonaut/Extension/pama-rating-auc-applied</code></td>
<td>OPTIONAL</td>
<td><code>*uri*</code></td>
<td>URL indicating the AUC applied. This value can be helpful, for example, to assess which specific AUCs are most often over-riddden.</td>
</tr>
</tbody>
</table>
<h3 id="cds-client-processes-pama-response">CDS Client Processes PAMA Response<a class="headerlink" href="#cds-client-processes-pama-response" title="Permanent link">&para;</a></h3>
<p>A CDS client, or EHR, <strong>SHOULD</strong> support the following behaviors to process a PAMA Response:</p>
<ul>
<li>Automatically incorporate appropriateness ratings from any actions in the top-level <code>extension.systemActions</code> array</li>
<li>Communicate any automatically-incorporated appropriateness ratings to the user</li>
<li>Store any automatically-incorporated appropriatness ratings and make them available for subsequent reporting</li>
<li>Correlate the CDS Service's client id with the CMS-issued G-code for subsequent reporting</li>
<li>Display any <em>suggestion</em> cards that convey valid alternative orders</li>
<li>Display <em>app link</em> cards to launch a SMART App with SMART Web Messaging support, allowing the CDS service to launch a companion app that can collect additional information through interacting with the clinician, and allowing the app to pass back a fully-scored order to the EHR when the interaction is complete.</li>
</ul>
<h3 id="cds-companion-app-updates-orders">CDS Companion App Updates Orders<a class="headerlink" href="#cds-companion-app-updates-orders" title="Permanent link">&para;</a></h3>
<p>If a CDS Service wants to launch a companion app for more detailed user interactions, it MAY return an app link card with a <code>type</code> of <code>smart</code>. This app link card SHALL include an <code>appContext</code> that the companion app can use to link the launch back to this specific CDS session, so that the companion app will have any necessary context about the users's current ordering task. (For example, the CDS Service may want to cache information about any draft orders that it learns about from the CDS Hooks invocation, so this information is readily available to the companion app; the cache key can be included in <code>appContext</code>.)</p>
<p><strong>Implementation note:</strong> <em>app link</em> values contains an <code>appContext</code> property that conveys relevant context; CDS Service developers are encouraged to use opaque handles into context stored server-side, or otherwise to make <code>appContext</code> values tamper-proof, rather than directly embedding data in the <code>appContext</code>.</p>
<p>When the CDS Client launches the companion app, it SHALL make the <code>appContext</code> and its own <code>smart_messaging_origin</code> available as launch context parameters, alongside the SMART access token response.</p>
<p>When the companion app runs, the CDS Client SHOULD enable access to the following SMART Web Messaging message types:</p>
<ul>
<li><code>scratchpad.update</code></li>
<li><code>scratchpad.create</code></li>
<li><code>scratchpad.delete</code></li>
<li><code>ui.done</code></li>
</ul>
<p>The <code>scratchpad.*</code> messages can be used with resource-type payloads <a href="https://github.com/smart-on-fhir/smart-web-messaging/blob/master/README.md#messagetype--scratchpad-fhir-api-interactions">as described in the SMART Web Messaging specification</a> to create, update, or remove draft orders from the CDS Client's UI state.</p>
<p>The <code>ui.done</code> message can be used <a href="https://github.com/smart-on-fhir/smart-web-messaging/blob/master/README.md#messagetype--ui-influence-ehr-ui">as described in the SMART Web Messaging specification</a> to close the app and return control back to the CDS Client, retaining the context from which the app was launched.</p>
<p><strong>Implementation note:</strong> After a companion app returns control to the EHR via <code>ui.done</code>, the EHR will typically re-invoke the CDS Service with updated orders (i.e., based on the <code>scratchpad.*</code> messages sent by the app). The CDS Service can correlate this re-invocation with the previous app invocation by using a combination or <code>ServiceRequest.id</code> values and <code>pama-rating-consult-id</code> extension values -- so any information collected from the clinician during app interactions can be applied in responding to re-invocation. For example, if a clinician answered a question in-app like "Are any of the following red-flag symptoms present?", then the answers to that question can be re-applied to any follow-up queries that result after the app has called <code>ui.done</code>.</p>
<h2 id="end-to-end-example-cds-scenario">End to end example CDS Scenario<a class="headerlink" href="#end-to-end-example-cds-scenario" title="Permanent link">&para;</a></h2>
<h3 id="cds-client">CDS Client<a class="headerlink" href="#cds-client" title="Permanent link">&para;</a></h3>
<p>Example request:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code>{
    &quot;hook&quot;: &quot;order-select&quot;,
    &quot;hookInstance&quot;: &quot;d1577c69-dfbe-44ad-ba6d-3e05e953b2ea&quot;,
    &quot;fhirServer&quot;: &quot;http://hooks.smarthealthit.org:9080&quot;,
    &quot;context&quot;: {
        &quot;userId&quot;: &quot;Practitioner/123&quot;,
        &quot;patientId&quot;: &quot;MRI-59879846&quot;,
        &quot;encounterId&quot;: &quot;89284&quot;,
        &quot;selections&quot;: [
            &quot;ServiceRequest/example-MRI-59879846&quot;
        ],
        &quot;draftOrders&quot;: {
            &quot;resourceType&quot;: &quot;Bundle&quot;,
            &quot;entry&quot;: [{
                &quot;resource&quot;: {
                    &quot;resourceType&quot;: &quot;ServiceRequest&quot;,
                    &quot;id&quot;: &quot;example-MRI-59879846&quot;,
                    &quot;status&quot;: &quot;draft&quot;,
                    &quot;intent&quot;: &quot;plan&quot;,
                    &quot;code&quot;: {
                        &quot;coding&quot;: [{
                            &quot;system&quot;: &quot;http://loinc.org&quot;,
                            &quot;code&quot;: &quot;36801-9&quot;
                        }],
                        &quot;text&quot;: &quot;MRA Knee Vessels Right&quot;
                    },
                    &quot;subject&quot;: {
                        &quot;reference&quot;: &quot;Patient/MRI-59879846&quot;
                    },
                    &quot;reasonCode&quot;: [{
                        &quot;coding&quot;: [{
                            &quot;system&quot;: &quot;http://hl7.org/fhir/sid/icd-10&quot;,
                            &quot;code&quot;: &quot;S83.511&quot;,
                            &quot;display&quot;: &quot;Sprain of anterior cruciate ligament of right knee&quot;
                        }]
                    }]
                }
            }]
        }
    }
}
</code></pre></div>
</td></tr></table>

<p>Need to add Prefetch!</p>
<h3 id="cds-service-responses">CDS Service Responses<a class="headerlink" href="#cds-service-responses" title="Permanent link">&para;</a></h3>
<p>Example response when AUC "Not Applicable":</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;cards&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="nt">&quot;extension&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;systemActions&quot;</span><span class="p">:</span> <span class="p">[{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span><span class="p">,</span>
            <span class="nt">&quot;resource&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;ServiceRequest&quot;</span><span class="p">,</span>
                <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;example-MRI-59879846&quot;</span><span class="p">,</span>
                <span class="nt">&quot;extension&quot;</span><span class="p">:</span> <span class="p">[{</span>
                        <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://fhir.org/argonaut/Extension/pama-rating&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;valueCodeableConcept&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;coding&quot;</span><span class="p">:</span> <span class="p">[{</span>
                                <span class="nt">&quot;system&quot;</span><span class="p">:</span> <span class="s2">&quot;http://fhir.org/argonaut/CodeSystem/pama-rating&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;no-criteria-apply&quot;</span>
                            <span class="p">}]</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://fhir.org/argonaut/Extension/pama-rating-consult-id&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;valueUri&quot;</span><span class="p">:</span> <span class="s2">&quot;urn:uuid:55f3b7fc-9955-420e-a460-ff284b2956e6&quot;</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;draft&quot;</span><span class="p">,</span>
                <span class="nt">&quot;intent&quot;</span><span class="p">:</span> <span class="s2">&quot;plan&quot;</span><span class="p">,</span>
                <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;coding&quot;</span><span class="p">:</span> <span class="p">[{</span>
                        <span class="nt">&quot;system&quot;</span><span class="p">:</span> <span class="s2">&quot;http://loinc.org&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;36801-9&quot;</span>
                    <span class="p">}],</span>
                    <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;MRA Knee Vessels Right&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;subject&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;reference&quot;</span><span class="p">:</span> <span class="s2">&quot;Patient/MRI-59879846&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;reasonCode&quot;</span><span class="p">:</span> <span class="p">[{</span>
                    <span class="nt">&quot;coding&quot;</span><span class="p">:</span> <span class="p">[{</span>
                        <span class="nt">&quot;system&quot;</span><span class="p">:</span> <span class="s2">&quot;http://hl7.org/fhir/sid/icd-10&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;S83.511&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;display&quot;</span><span class="p">:</span> <span class="s2">&quot;Sprain of anterior cruciate ligament of right knee&quot;</span>
                    <span class="p">}]</span>
                <span class="p">}]</span>
            <span class="p">}</span>
        <span class="p">}]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>Example response when criteria <em>do</em> apply:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;cards&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="nt">&quot;extension&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;systemActions&quot;</span><span class="p">:</span> <span class="p">[{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span><span class="p">,</span>
            <span class="nt">&quot;resource&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;resourceType&quot;</span><span class="p">:</span> <span class="s2">&quot;ServiceRequest&quot;</span><span class="p">,</span>
                <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;example-MRI-59879846&quot;</span><span class="p">,</span>
                <span class="nt">&quot;extension&quot;</span><span class="p">:</span> <span class="p">[{</span>
                        <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://fhir.org/argonaut/Extension/pama-rating&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;valueCodeableConcept&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;coding&quot;</span><span class="p">:</span> <span class="p">[{</span>
                                <span class="nt">&quot;system&quot;</span><span class="p">:</span> <span class="s2">&quot;http://fhir.org/argonaut/CodeSystem/pama-rating&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;appropriate&quot;</span>
                            <span class="p">}]</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://fhir.org/argonaut/Extension/pama-rating-consult-id&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;valueUri&quot;</span><span class="p">:</span> <span class="s2">&quot;urn:uuid:55f3b7fc-9955-420e-a460-ff284b2956e6&quot;</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;draft&quot;</span><span class="p">,</span>
                <span class="nt">&quot;intent&quot;</span><span class="p">:</span> <span class="s2">&quot;plan&quot;</span><span class="p">,</span>
                <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;coding&quot;</span><span class="p">:</span> <span class="p">[{</span>
                        <span class="nt">&quot;system&quot;</span><span class="p">:</span> <span class="s2">&quot;http://loinc.org&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;36801-9&quot;</span>
                    <span class="p">}],</span>
                    <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;MRA Knee Vessels Right&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;subject&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;reference&quot;</span><span class="p">:</span> <span class="s2">&quot;Patient/MRI-59879846&quot;</span>
                <span class="p">},</span>
                <span class="nt">&quot;reasonCode&quot;</span><span class="p">:</span> <span class="p">[{</span>
                    <span class="nt">&quot;coding&quot;</span><span class="p">:</span> <span class="p">[{</span>
                        <span class="nt">&quot;system&quot;</span><span class="p">:</span> <span class="s2">&quot;http://hl7.org/fhir/sid/icd-10&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;S83.511&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;display&quot;</span><span class="p">:</span> <span class="s2">&quot;Sprain of anterior cruciate ligament of right knee&quot;</span>
                    <span class="p">}]</span>
                <span class="p">}]</span>
            <span class="p">}</span>
        <span class="p">}]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h3 id="references-and-links">References and Links<a class="headerlink" href="#references-and-links" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://microsoft-healthcare-madison.github.io/demo-auc-app">Codelab Tutorial</a></li>
<li><a href="https://www.cms.gov/medicare/quality-initiatives-patient-assessment-instruments/appropriate-use-criteria-program/index.html">AUC program backgrround</a> (official <a href="https://www.cms.gov/Regulations-and-Guidance/Guidance/Transmittals/2018Downloads/R2040OTN.pdf">PDF document</a>)</li>
<li><a href="https://www.cms.gov/Outreach-and-Education/Medicare-Learning-Network-MLN/MLNMattersArticles/Downloads/MM10481.pdf">Information on CMS requirements, QQ modifier, and list of CPT codes for relevant orders</a></li>
<li><a href="https://www.cms.gov/Medicare/Quality-Initiatives-Patient-Assessment-Instruments/Appropriate-Use-Criteria-Program/PLE.html">Offical provider led entities</a></li>
<li><a href="https://intermountainhealthcare.org/services/imaging-services/proven-imaging/step-1/">Intermountain Proven Imaging</a></li>
<li><a href="https://www.acr.org/Clinical-Resources/ACR-Appropriateness-Criteria">American College of Radiology (ACR) criteria</a></li>
</ul>
<h3 id="steps-to-add-once-web-messaging-spec-is-ready">Steps to add once Web Messaging spec is ready<a class="headerlink" href="#steps-to-add-once-web-messaging-spec-is-ready" title="Permanent link">&para;</a></h3>
<ul>
<li>Additional Client (EHR) expectations</li>
<li>Ability to work in the CDS service, provide additional information, and have that flow back to EHR scratchpad</li>
<li>Process for &#39;re-triggering&#39; the order-select hook after changes have been made in both the CDS service and EHR. Is this a brand-new request? Is some sort of context retained to help CDS service?</li>
<li>Error conditions</li>
<li>Storage/tracking of information provided by the CDS service. Is this any different than non SMART Messaging case?</li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            © 2018 HL7 & Boston Children's Hospital.<p /> <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/argonautproject/cds-hooks-for-pama" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>